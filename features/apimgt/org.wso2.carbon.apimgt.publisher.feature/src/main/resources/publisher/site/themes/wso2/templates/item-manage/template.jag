<% jagg.template("item-manage", function(inputs, outputs, jagg) {

    var api = outputs.api;
    var createPermitted = outputs.isCreatePermitted;
    var apiUrlId = "name="+encode.forHtml(api.name)+"&version="+encode.forHtml(api.version)+"&provider="+encode.forHtml(api.provider);
    //get environments detail from api-manager.xml
    var provider = jagg.module("manager").getAPIProviderObj();
    var environmentsList=provider.getEnvironments();
    //fetch and display tiers
    var mod = jagg.module("api");
    var tiers = mod.getTiers().tiers;
    var resourceTiers = mod.getResourceTiers().tiers;
    var default_tier = resourceTiers[resourceTiers.length -1].tierName;
    var isWSAPI = api.type.toUpperCase() == "WS";

    var hasCustomSequences = false;
    if((api.inSequence && (!"none".equals(api.inSequence))) || (api.outSequence && (!"none".equals(api.outSequence)))
        || ( api.faultSequence && (!"none".equals(api.faultSequence)))) {
        hasCustomSequences = true;
    }

    //fetch gateway labels in the tenant space
    var labels = mod.getLabels().labels;
    //fetch labels attached to the current API
    var attachedLabels = api.gatewayLabels;

    for (var i = 0; i < resourceTiers.length; i++){
        if(resourceTiers[i].defaultTier){
            default_tier = resourceTiers[i].tierName;
            break;
        }
    }

    var enableSelectedTenantSubscription = site.enableSelectedTenantSubscription;
    var storeUrl = jagg.module("manager").getAPIStoreURL().url;

    var MultitenantUtils = Packages.org.wso2.carbon.utils.multitenancy.MultitenantUtils;
    var tenantDomain = MultitenantUtils.getTenantDomain(jagg.getUser().username);
%>
<script language="javascript">
    var VERBS = [ 'GET' , 'POST' , 'PUT' , 'DELETE', 'PATCH', 'OPTIONS'];
    var AUTH_TYPES = [
      { "value": "None", "text":"<%=i18n.localize("None")%>"} ,
      { "value": "Application", "text":"<%=i18n.localize("Application")%>"},
      { "value": "Application User", "text":"<%=i18n.localize("Application User")%>"},
      { "value": "Application & Application User", "text":"<%=i18n.localize("Application & Application User")%>"}
    ];
    var TIERS =[
        <% for (var i = 0; i < resourceTiers.length; i++) {
        %>{ "value": "<%= encode.forJavaScript(String(resourceTiers[i].tierName)) %>", "text": "<%= encode.forJavaScript(String(resourceTiers[i].tierDisplayName)) %>"
        }<% if(
        (i+1) != resourceTiers.length){%>,<%}%>
        <% } %>
    ];

    var DEFAULT_TIER = "<%=encode.forJavaScript(String(default_tier))%>";
    var DEFAULT_AUTH = "Application & Application User";
    var OPTION_DEFAULT_AUTH = "None";

    var insequence = "<%=api.inSequence%>";
    var outsequence = "<%=api.outSequence%>";
    var faultsequence = "<%=api.faultSequence%>";
    var inSequencesLoaded = false;
    var outSequencesLoaded = false;
    var faultSequencesLoaded = false;
    var ws = "<%=isWSAPI%>";
    var hasCustomSequences = <%=hasCustomSequences%>;
</script>
<div id="item-add">
<%
    var design_w_link = jagg.url('/design?'+apiUrlId);
    var implement_w_link = jagg.url('/implement?'+apiUrlId);
    var manage_w_link = jagg.url('/manage?'+apiUrlId);
%>
<!-- <center>
<%if(createPermitted){%>
<ul class="new-sub-menu-wizard" style="margin:0 auto">
    <li>
        <a href="<%= design_w_link %>" class="wizard-done" title="<%=i18n.localize("Design")%>">
            <div class="wizard-number">1</div>
            <span><%=i18n.localize("Design")%></span>
        </a>
    </li>
    <li>
        <a href="<%= implement_w_link %>" class="wizard-done" title="<%=i18n.localize("Implement")%>">
            <div class="wizard-number">2</div>
            <span><%=i18n.localize("Implement")%></span>
        </a>
    </li>
    <li>
        <a href="<%= manage_w_link %>" class="wizard-active" title="<%=i18n.localize("Manage")%>">
            <div class="wizard-number">3</div>
            <span><%=i18n.localize("Manage")%></span>
        </a>
    </li>
</ul>
<%}%>

</center>-->
	<div class="page-header">
 		<h2> <%= encode.forHtml(api.name) %> : <%= encode.forHtml(api.context) %>
        </h2>
 	</div>
    <div class="content-section shadow-up">
    <div class="content-data">
	    <div class="alert alert-danger" id="addAPIError" style="display:none">
	        <span id="addErrorSpan"></span>
	    </div>
		<% if(api != null && api.subs > 0){%>
		    <div class="message message-warning">
                <h4><i class="icon fw fw-warning"></i><%=i18n.localize("Warning!")%></h4>
                <p><%=i18n.localize("You are editing an API with active subscribers. Tier Availability changes will not be reflected on active subscriptions.")%></p>
            </div>
		  <%  }%>

		  <div id="apiSaved" class="alert alert-success" role="alert" style="display:none">
   		<i class="icon fw fw-success fade out"></i><strong><%=i18n.localize("Success!")%></strong>
                    <%=i18n.localize("You have successfully saved the API.")%>
                    <button type="button" class="close" aria-label="close" data-dismiss="alert">
                        <span aria-hidden="true">
                            <i class="fw fw-cancel"></i>
                        </span>
                    </button>
   </div>


		  <div class="">
                <div class="row">
                    <div class="wizard col-xs-12">
                        <div class="wizard-inner">
                        	<%if(createPermitted){%>
	                            <ol class="wiz-nav-inner no-controls" >
	                                <li class="wiz-step completed"><a href="<%= design_w_link %>" title="<%=i18n.localize("Design")%>"><span class="wiz-step-count">1</span><span class="hidden-xs wiz-step-title"><%=i18n.localize("Design")%></span></a></li>
	                                <li class="wiz-step completed"><a href="<%= implement_w_link %>" title="<%=i18n.localize("Implement")%>"><span class="wiz-step-count">2</span><span class="hidden-xs wiz-step-title"><%=i18n.localize("Implement")%></span></a></li>
	                                <li class="wiz-step current"><a href="<%= manage_w_link %>" title="<%=i18n.localize("Manage")%>"><span class="wiz-step-count">3</span><span class="hidden-xs wiz-step-title"><%=i18n.localize("Manage")%></span></a></li>
	                            </ol>
	                        <%} %>
                        </div>
                        <div class="wiz-content">

                        		   <div class="row">
        <div class="col-sm-12">
            <form class="form-horizontal apim-form" method="POST"
              id="manage_form"
              enctype="multipart/form-data" action="<%= jagg.url("/site/blocks/item-design/ajax/add.jag?" + apiUrlId ) %>&action=manage">
                  <input type="hidden" id="type" name="type" value="<%=api.type%>"/>

                <div class="panel-group accordion">
                    <%if(!isWSAPI){%>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <div>
                                    <div class="heading no-description"><%=i18n.localize("Configurations")%></div>
                                </div>
                                <div class="clearfix"></div>
                            </h4>
                        </div>
                        <div class="panel-collapse">
                            <div class="panel-body">
                                        <div class="form-group">
                                            <label class = "col-sm-3 control-label"><%=i18n.localize("Make this the Default version:")%>
                                                <a class="help_popup" help_data="default_api_help" title="default_api_help" data-trigger="hover" data-placement="bottom">
                                                    <span class="icon fw-stack fw-lg" style="font-size:6px">
                                                        <i class="fw fw-circle fw-stack-2x"></i>
                                                        <i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                                    </span>
                                                </a>
                                                <p id="default_api_help" class="hide"><%=i18n.localize("Marks one API version in a group as the default so that it can be invoked without specifying the version number in the URL. For example, if you mark http://host:port/youtube/2.0 as the default API, requests made to http://host:port/youtube/ are automatically routed to version 2.0. If you mark an unpublished API as the default, the previous default published API will still be used as the default until the new default API is published")%></p>
                                            </label>
                                            <div class="controls col-sm-8">
                                                  <label class="checkbox">
                                                    <input type="checkbox" id="default_version" class="default_version_check" name="default_version" value="default_version" <%if(api.isDefaultVersion=="true"){%>checked<%}%>>
                                                    <span class="helper"></span>
                                                </label>

                                                 <%if(api.isDefaultVersion=="false"){if(api.hasDefaultVersion){%>
                                                     <p class="help-block"><%=i18n.localize("Currently set to version")%> : <%=api.currentDefaultVersion%></p>
                                                 <%}else{%>
                                                     <p class="help-block"><%=i18n.localize("No default version defined for the current API")%></p>
                                                 <%}}%>
                                            </div>
                                             <input type="hidden" id="default_version_checked" name="default_version_checked" value=<%if(api.isDefaultVersion=="true"){%>"default_version"<%}else{%>""<%}%>/>
                                            </div>
                                        <div class="form-group transport-styles">
                                        <label class="control-label col-sm-3" for="transports"><%=i18n.localize("Transports")%>:<span class="requiredAstrix">*</span>
                                                <a class="help_popup" help_data="http_help" data-trigger="hover" title="http_help" data-placement="bottom">
                                                    <span class="icon fw-stack fw-lg" style="font-size:6px">
                                                            <i class="fw fw-circle fw-stack-2x"></i>
                                                            <i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                                    </span>
                                                </a>
                                                <p id="http_help" class="hide"><%=i18n.localize("HTTP is less secure than HTTPS and makes your API vulnerable to security threats.")%></p>
                                        </label>
                                        <div class="controls col-sm-8">
                                                <label class="checkbox">
                                                        <input type="checkbox" id="transport_https" name="transport_https"  value="https" <%if(api.transport_https=="checked"){%>checked<%}%>/>
                                                        <span class="helper"><%=i18n.localize("HTTPS")%></span>
                                                </label>
                                                <label class="checkbox">
                                                        <input type="checkbox" id="transport_http" name="transport_http"  value="http" <%if(api.transport_http=="checked"){%>checked<%}%>/>
                                                        <span class="helper"><%=i18n.localize("HTTP")%></span>
                                                </label>
                                                <label id="transport_error" class="error hide" style="display: block;"><%=i18n.localize("Please select at least one transport.")%></label>
                                            </div>
                                        </div>

                                         <!--Response Caching -->
                                            <div class="form-group">
                                                <label class="control-label col-sm-3" for="responseCache"><%=i18n.localize("Response Caching")%>:
                                                    <a class="help_popup" help_data="cache_help" title="cache_help" data-trigger="hover" data-placement="bottom">
                                                        <span class="icon fw-stack fw-lg" style="font-size:6px">
                                                            <i class="fw fw-circle fw-stack-2x"></i>
                                                            <i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                                        </span>
                                                    </a>
                                                    <p id="cache_help" class="hide"><%=i18n.localize("This option determines whether to cache the response messages of the API. Caching improves performance because the backend server does not have to process the same data multiple times. To offset the risk of stale data in the cache, set an appropriate timeout period when prompted.")%></p>
                                                </label>
                                                  <div class="col-sm-4 responseCacheSelect">
                                                   <select class="select required form-control" id="responseCache" name="responseCache">
                                                        <option value="disabled" <%if(api.responseCache != "Enabled"){%> selected="selected" <%}%>><%=i18n.localize("Disabled")%></option>
                                                        <option value="enabled" <%if(api.responseCache=="Enabled"){%> selected="selected" <%}%>><%=i18n.localize("Enabled")%></option>
                                                    </select>
                                                 </div>
                                            </div>
                                            <div class="form-group" id="cacheTimeout"  <%if(api.responseCache != "Enabled"){%> style="display:none;" <%}%>>
                                                <label class="control-label col-sm-3" for="cacheTimeout"><%=i18n.localize("Cache Timeout (seconds)")%>:<span class="requiredAstrix">*</span></label>
                                                <div class="col-sm-4">
                                                    <input type="text" class="form-control input-small required validInput number" id="cacheTimeout" name="cacheTimeout" value=<%=api.cacheTimeout%>>
                                                </div>
                                            </div>


                                            <% mod = jagg.module("api");
                                                result = mod.isMultipleTenantsAvailable();
                                                var isMultipleTenantsAvailable = result.status;
                                                if(api.visibility == "public" && isMultipleTenantsAvailable == true){%>
                                                    <div class="form-group">
                                                        <label class="control-label col-sm-3" for="subscriptions"><%=i18n.localize("Subscriptions")%>:
                                                            <a class="help_popup" help_data="subscriptions_help" title="subscriptions_help" data-trigger="hover" data-placement="bottom">
                                                                <span class="icon fw-stack fw-lg" style="font-size:6px">
                                                                    <i class="fw fw-circle fw-stack-2x"></i>
                                                                    <i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                                                </span>
                                                            </a>
                                                            <p id="subscriptions_help" class="hide"><%=i18n.localize("This option specifies the tenants who can subscribe to an API in a multi-tenanted setup. <strong> Available to current Tenant Only:</strong> only users in the current organization/tenant domain can subscribe to the API <strong>Available to All the Tenants:</strong> users of all organizations/tenant domains can subscribe to the API <strong> Available to Specific Tenants:</strong> users of the organizations/tenant domains you specify as well as the current tenant domain can subscribe to the API")%></p>
                                                        </label>
                                                        <div class="col-sm-4">
                                                            <% if(api.visibility!="public") {%>
                                                            <select class="select required form-control" id="subscriptions" name="subscriptions" >
                                                                <option value="current_tenant"  selected="selected"><%=i18n.localize("Available to current tenant only")%></option>
                                                            </select>
                                                            <%} else {%>
                                                                <select class="select required form-control" id="subscriptions" name="subscriptions" >
                                                                <option value="current_tenant" <%if(api.subscriptionAvailability=="current_tenant"){%> selected="selected" <%}%> ><%=i18n.localize("Available to current tenant only")%></option>
                                                                <option value="all_tenants" <%if(api.subscriptionAvailability=="all_tenants"){%> selected="selected" <%}%> ><%=i18n.localize("Available to all the tenants")%></option>
                                                                    <% if(!(enableSelectedTenantSubscription == 'false')) {%>
                                                                    <option value="specific_tenants" <%if(api.subscriptionAvailability=="specific_tenants"){%> selected="selected" <%}%> ><%=i18n.localize("Available to specific tenants")%></option>
                                                                    <% } %>
                                                                </select>
                                                            <%}%>
                                                       </div>
                                                       </div>
                                                           <div class="form-group" id="tenantsDiv" <%if(api.subscriptionAvailability!="specific_tenants"){%>style="display: none;"<%}%>>
                                                               <label class="control-label col-sm-3" for="tenants" id="tenantLabel" name="tenantLabel">
                                                                   <%=i18n.localize("Visible to Tenants")%>:<span class="requiredAstrix">*</span>
                                                               </label>
                                                               <div class="col-sm-4">
                                                                   <input type="text" class="input form-control"
                                                                   id="tenants" name="tenants" value="<%=api.subscriptionTenants%>"/>
                                                                   <p class="help-block" id="tenantsHelp"><%=i18n.localize("Comma separated list (e.g.,: tenant1,tenant2,tenant3)")%></p>
                                                               </div>

                                                           </div>

                                                    <% } %>
                                        <!--Response Caching End -->
                                        <!--Custom Authorization Header Start-->
                                                           <div id="authConfigs form-control">
                                                                <div class="form-group">
                                                                    <label class="control-label col-sm-3" for="authConfiguration"><%=i18n.localize("Authorization Header")%>:
                                                                        <a class="help_popup" help_data="authorization_header_help" title="authorization_header_help" data-trigger="hover" data-placement="bottom">
                                                                            <span class="icon fw-stack fw-lg" style="font-size:6px">
                                                                                <i class="fw fw-circle fw-stack-2x"></i>
                                                                                <i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                                                            </span>
                                                                        </a>
                                                                    <p id="authorization_header_help" class="hide"><%=i18n.localize("Here a custom authorization header can be defined as a replacement to the default <strong>Authorization</strong> header used to send a request. If a value is specified here, that will be used as the header field to send the access token in a request to consume the API")%></p>
                                                                    </label>
                                                                    <div class="controls col-sm-4">
                                                                         <input type="text" class="form-control" id="authorizationHeader" name="authorizationHeader"
                                                                           placeholder="Authorization"  value="<%=encode.forHtml(api.authorizationHeader)%>">
                                                                    </div>
                                                                </div>
                                                           </div>
                                        <!--Custom Authorization Header End-->
                            </div>
                        </div>
                    </div>
                    <%}else{%>
                    <input type="checkbox" id="transport_http" class="hidden" name="transport_http"  value="http" <%if(api.transport_http=="checked"){%>checked<%}%>/>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <div>
                                    <div class="heading no-description"><%=i18n.localize("Configurations")%></div>
                                </div>
                                <div class="clearfix"></div>
                            </h4>
                        </div>
                        <div class="panel-collapse">
                            <div class="panel-body">
                                <div class="form-group">
                                    <label class = "col-sm-3 control-label"><%=i18n.localize("Make this the Default version:")%>
                                        <a class="help_popup" help_data="default_api_help" title="default_api_help" data-trigger="hover" data-placement="bottom">
                                            <span class="icon fw-stack fw-lg" style="font-size:6px">
                                                <i class="fw fw-circle fw-stack-2x"></i>
                                                <i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                            </span>
                                        </a>
                                        <p id="default_api_help" class="hide"><%=i18n.localize("Marks one API version in a group as the default so that it can be invoked without specifying the version number in the URL. For example, if you mark http://host:port/youtube/2.0 as the default API, requests made to http://host:port/youtube/ are automatically routed to version 2.0. If you mark an unpublished API as the default, the previous default published API will still be used as the default until the new default API is published")%></p>
                                    </label>
                                    <div class="controls col-sm-8">
                                        <label class="checkbox">
                                            <input type="checkbox" id="default_version" class="default_version_check" name="default_version" value="default_version"        <%if(api.isDefaultVersion=="true"){%>checked<%}%>>
                                            <span class="helper"></span>
                                        </label>
                                        <%if(api.isDefaultVersion=="false"){if(api.hasDefaultVersion){%>
                                        <p class="help-block"><%=i18n.localize("Currently set to version")%> : <%=api.currentDefaultVersion%></p>
                                        <%}else{%>
                                        <p class="help-block"><%=i18n.localize("No default version defined for the current API")%></p>
                                        <%}}%>
                                    </div>
                                    <input type="hidden" id="default_version_checked" name="default_version_checked" value=<%if(api.isDefaultVersion=="true")       {%>"default_version"<%}else{%>""<%}%>/>
                                </div>

                            </div>
                        </div>
                    </div>



                    <% mod = jagg.module("api");
                    result = mod.isMultipleTenantsAvailable();
                    var isMultipleTenantsAvailable = result.status;
                    if(api.visibility == "public" && isMultipleTenantsAvailable == true){%>
                    <div class="form-group">
                        <label class="control-label col-sm-3" for="subscriptions"><%=i18n.localize("Subscriptions")%>:
                            <a class="help_popup" help_data="subscriptions_help" title="subscriptions_help" data-trigger="hover" data-placement="bottom">
                                <span class="icon fw-stack fw-lg" style="font-size:6px">
                                    <i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                </span>
                            </a>
                            <p id="subscriptions_help" class="hide"><%=i18n.localize("This option specifies the tenants who can subscribe to an API in a multi-tenanted setup. <strong> Available to current Tenant Only:</strong> only users in the current organization/tenant domain can subscribe to the API <strong>Available to All the Tenants:</strong> users of all organizations/tenant domains can subscribe to the API <strong> Available to Specific Tenants:</strong> users of the organizations/tenant domains you specify as well as the current tenant domain can subscribe to the API")%></p>
                        </label>
                        <div class="col-sm-4">
                            <% if(api.visibility!="public") {%>
                            <select class="select required form-control" id="subscriptions" name="subscriptions" >
                                <option value="current_tenant"  selected="selected"><%=i18n.localize("Available to current tenant only")%></option>
                            </select>
                            <%} else {%>
                            <select class="select required form-control" id="subscriptions" name="subscriptions" >
                                <option value="current_tenant" <%if(api.subscriptionAvailability=="current_tenant"){%> selected="selected" <%}%> ><%=i18n.localize("Available to current tenant only")%></option>
                                <option value="all_tenants" <%if(api.subscriptionAvailability=="all_tenants"){%> selected="selected" <%}%> ><%=i18n.localize("Available to all the tenants")%></option>
                                <% if(!(enableSelectedTenantSubscription == 'false')) {%>
                                <option value="specific_tenants" <%if(api.subscriptionAvailability=="specific_tenants"){%> selected="selected" <%}%> ><%=i18n.localize("Available to specific tenants")%></option>
                                <% } %>
                            </select>
                            <%}%>
                        </div>
                    </div>
                    <div class="form-group" id="tenantsDiv" <%if(api.subscriptionAvailability!="specific_tenants"){%>style="display: none;"<%}%>>
                        <label class="control-label col-sm-3" for="tenants" id="tenantLabel" name="tenantLabel">
                            <%=i18n.localize("Visible to Tenants")%>:<span class="requiredAstrix">*</span>
                        </label>
                        <div class="col-sm-4">
                            <input type="text" class="input form-control"id="tenants" name="tenants" value="<%=api.subscriptionTenants%>"/>
                            <p class="help-block" id="tenantsHelp"><%=i18n.localize("Comma separated list (e.g.,: tenant1,tenant2,tenant3)")%></p>
                        </div>
                    </div>
                    <% } %>
                <%}%>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <div>
                                    <div class="heading no-description"><%=i18n.localize("Throttling Settings")%></div>
                                </div>
                                <div class="clearfix"></div>
                            </h4>
                        </div>
                        <div class="panel-collapse">
                            <div class="panel-body">

                                        <% if (isSynapseGateway && !isWSAPI) { %>
                                                    <div class="form-group">
                                                        <label class="control-label col-sm-3" for="throttle"><%=i18n.localize("Maximum Backend Throughput")%> :
                                                         <a class="help_popup" help_data="hard_throttle_help" title="hard_throttle_help" data-trigger="hover" data-placement="bottom">
                                                            <span class="icon fw-stack fw-lg" style="font-size:6px">
                                                                <i class="fw fw-circle fw-stack-2x"></i>
                                                                <i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                                            </span>
                                                        </a>
                                                        <p id="hard_throttle_help" class="hide"><%=i18n.localize("Limits the total number of calls the API Manager is allowed to make to the backend.")%></p>

                                                        </label>
                                                        <div class="col-sm-8">
                                                            <label class="radio">
                                                                <input type="radio" class="backend_tps" id ="backend_tps_unlimited" name="backend_tps" <%if( api.productionTps == "" && api.sandboxTps == "" ){ %>
                                                                checked="checked"<%}%> value="unlimited">
                                                                <span class="helper"><%=i18n.localize("Unlimited")%></span>
                                                            </label>
                                                            <label class="radio">
                                                                <input type="radio" class="backend_tps" id ="backend_tps_specify" name="backend_tps" <%if(api.productionTps != "" || api.sandboxTps != ""){ %>
                                                                checked="checked"<%}%> value="specify">
                                                                <span class="helper"><%=i18n.localize("Specify")%></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group sub-form-group tps_boxes <%if( api.productionTps == "" && api.sandboxTps == "" ){ %>hide<%}%>">
                                                        <label class="control-label col-sm-3" for="throttle"><%=i18n.localize("Production TPS")%>
                                                        </label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control validInput" id="productionTps" name="productionTps" placeholder="<%=i18n.localize("Max TPS")%>" value="<%=api.productionTps%>">
                                                        </div>
                                                    </div>
                                                    <div class="form-group sub-form-group tps_boxes <%if( api.productionTps == "" && api.sandboxTps == "" ){ %>hide<%}%>">
                                                        <label class="control-label col-sm-3" for="throttle"><%=i18n.localize("Sandbox TPS")%>
                                                        </label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control validInput" id="sandboxTps" name="sandboxTps" placeholder="<%=i18n.localize("Max TPS")%>" value="<%=api.sandboxTps%>">
                                                        </div>
                                                    </div>
                                                    <%}%>



                                            <hr />
                                            <div class="form-group" id="subscription-tiers">
                                        	    <label class="control-label col-sm-3" for="tiertier">
                                                    <%=i18n.localize("Subscription Tiers")%>:
                                                    <span class="requiredAstrix">*</span>
                                                    <a class="help_popup" help_data="tier_help" data-trigger="hover" data-placement="bottom">
                                            		    <span class="icon fw-stack fw-lg" style="font-size:6px">
                                        				    <i class="fw fw-circle fw-stack-2x"></i>
                                        					<i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                        			    </span>
                                            	    </a>
                                            	    <p id="tier_help" class="hide"><%=i18n.localize("The tiers selected here determine which tiers are available to a subscriber when subscribing to this API. Each tier indicates the number of requests the subscriber is granted within a unit time.")%></p>
                                                </label>
                                                <div class="controls col-sm-4 tierSelect">
                                        			<%
                                                        for (var i = 0; i < tiers.length; i++) {
                                                            var isSelected = api.availableTiers.indexOf(tiers[i].tierName) > -1;
                                                        %>
                                                        <label id="<%=tiers[i].tierName%>" class="tier_checkbox_label checkbox add-padding-bottom-1x">
                                                                <input type="checkbox" class="tier_check" name="tier" value="<%= encode.forHtmlAttribute(String(tiers[i].tierName))%>" <%if(isSelected){%>checked<%}%>>
                                                                <span class="helper"><strong><%= encode.forHtml(String(tiers[i].tierDisplayName)) %></strong> : <%= encode.forHtml(String(tiers[i].tierDescription)) %></span>
                                                        </label>
                                                        <%
                                                        }
                                                    %>
                                                   <label id="tier_error" class="error hide" style="display: block;"><%=i18n.localize("Please select at least one subscription tier.")%></label>
                                                </div>
                                        	</div>


                                        <%  if(mod.isGlobalCEPThrottlingEnabled() || isWSAPI){%>
                                            <hr />
                                            <div class="form-group">
                                                <label class="control-label col-sm-3" for="apiPolicy"><%=i18n.localize("Advanced Throttling Policies")%>:
                                                    <%if(!isWSAPI){%>
                                                    <a class="help_popup" help_data="api_policy_help" title="api_policy_help" data-trigger="hover" data-placement="bottom">
                                                    	<span class="icon fw-stack fw-lg" style="font-size:6px">
                                            				<i class="fw fw-circle fw-stack-2x"></i>
                                            				<i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                            			</span>
                                                    </a>
                                                    <p id="api_policy_help" class="hide"><%=i18n.localize("Enabling an API-level policy will apply the selected policy across all resources of the API. The resources level tier selection will be disabled and will not be taken into consideration within a handler if the API-level policy is available")%></p>
                                                </label>
                                                <div class="controls col-sm-8">
                                                    <label class="radio">
                                                            <input type="radio" id="api_level_policy" class="api_level_policy" name="api_level_policy" value="api_level_policy" <%if(api.apiLevelPolicy != null && api.apiLevelPolicy != ""){%>checked<%}%>>
                                                            <span class="helper"><%=i18n.localize("Apply to API")%></span>
                                                    </label>
                                                    <label class="radio">
                                                            <input type="radio" id="api_level_policy" class="api_level_policy" name="api_level_policy" value="resource_level" <%if(api.apiLevelPolicy == null || api.apiLevelPolicy == ""){%>checked<%}%>>
                                                            <span class="helper"><%=i18n.localize("Apply per Resource")%></span>
                                                    </label>
                                                </div><%}else{%>
                                                        <a class="help_popup" help_data="api_policy_help" title="api_policy_help" data-trigger="hover" data-placement="bottom">
                                                    	<span class="icon fw-stack fw-lg" style="font-size:6px">
                                            				<i class="fw fw-circle fw-stack-2x"></i>
                                            				<i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                            			</span>
                                                    </a>

                                                    <p id="api_policy_help" class="hide"><%=i18n.localize("Since there aren't resources for Websocket API's, advanced throttling policies apply to the API-level")%></p>
                                                </label>
                                                        <div class="controls col-sm-8">
                                                    <label class="radio hide">
                                                            <input type="radio" id="api_level_policy" class="api_level_policy" name="api_level_policy" value="api_level_policy" checked>
                                                            <span class="helper"><%=i18n.localize("Apply to API")%></span>
                                                    </label>
                                                </div>
                                                        
                                                        <%}%>
                                            </div>
                                            <%if(!isWSAPI){%>
                                            <input type="hidden" id="enableApiLevelPolicy" name="enableApiLevelPolicy" value=<%if(api.apiLevelPolicy!=null && api.apiLevelPolicy!=""){%>"true"<%} else {%>"false"<%}%>/><%}else{%>
                                                <input type="hidden" id="enableApiLevelPolicy" name="enableApiLevelPolicy" value="true"/>
                                                <%}%>
                                          	<div class="form-group">
                                          		<div class="control-label col-sm-3"></div>
                                                 <%if(!isWSAPI){%>
                                              	 <div class="col-sm-4" id="api-level-policy-section" <%if(api.apiLevelPolicy!=null && api.apiLevelPolicy!=""){%>style="display:block"<%} else {%>style="display:none"<%}%>>
                                                     <%}else{%>
                                                         <div class="col-sm-4" id="api-level-policy-section" style="display:block">
                                                         <%}%>
                                                    <select id="apiTier" name="apiTier"  class="form-control selected required">
                                                    <%
                                                    for (var i = 0; i < resourceTiers.length; i++) {
                                                        var isSelectedAPITier = api.availableTiers.indexOf(resourceTiers[i].tierName) > -1;
                                                        var isSelected = false;
                                                        if(resourceTiers[i].tierName == api.apiLevelPolicy){
                                                            isSelected = true;
                                                        }
                                                        %><option value="<%= encode.forHtmlAttribute(String(resourceTiers[i].tierName))%>"
                                                        <%if
                                                        (isSelected){%>selected="selected"<%}%>><%= encode.forHtml(String(resourceTiers[i].tierDisplayName)) %></option>
                                                        <%
                                                    }
                                                    %>
                                                    </select>
                                                </div>
                                                         <%if(!isWSAPI){%>
                                                <div id="resource-policy-select" class="col-sm-4 <%if(api.apiLevelPolicy != null && api.apiLevelPolicy != ""){%>hide<%}%>"  >
                                                    <script id="resource-policy-ui-template" language="text/x-handlebars-template">
                                                        <a class="select_adv_policy_for_resource btn btn-secondary"><%=i18n.localize("Select Policy per Resource")%></a>
                                                        <div id="resource_policy_modal" class="modal fade">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                                    <h3><%=i18n.localize("Select Policy per Resource")%></h3>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <table class="table">
                                                                            <tr>
                                                                                <td colspan="2"><%=i18n.localize("Resource")%></td>
                                                                                <td><%=i18n.localize("Policy")%></th>
                                                                            </tr>
                                                                            {{#each doc.paths}}
                                                                                {{#each this}}
                                                                                <tr class="resource_container" data-path="">
                                                                                    <td class="resource-method-td resource_expand" data-path="$.paths.{{ @../key}}.{{ @key }}">
                                                                                        <span class=" resource-method resource-method-{{ @key }}">{{ @key }}</span>
                                                                                    </td>
                                                                                    <td><a class="resource-path" title="resource_path">{{ @../key}}</a></td>
                                                                                    <td>
                                                                                        <select class="form-control selected input-sm select_resource_policy" data-path="{{ @../key }}" data-method="{{@key}}" data-attr="x-throttling-tier">
                                                                                            {{#each ../../tiers}}
                                                                                                <option value="{{ this.value }}" {{#ifCond this.value '==' ../x-throttling-tier }}selected="selected"{{/ifCond}}>{{ this.text }}</option>
                                                                                            {{/each}}
                                                                                        </select>
                                                                                    </td>
                                                                                </tr>
                                                                                {{/each}}
                                                                            {{/each}}
                                                                        </table>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                    <div id="res" style="color:red;float:left"></div>
                                                                    <a href="#" class="btn btn-primary" data-dismiss="modal" title="<%=i18n.localize("Close")%>" ><%=i18n.localize("Close")%></a>
                                                                    <!-- a href="#" class="btn btn-primary" id="advance_ep_submit" title="<%=i18n.localize("Save")%>" ><%=i18n.localize("Save Changes")%></a -->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </script>
                                                    <a class=" help_popup" help_data="tier_help"></a>
                                                    <p id="tier_help" class="hide"><%=i18n.localize("The tiers selected here determine which tiers are available to a subscriber when subscribing to this API. Each tier indicates the number of requests the subscriber is granted within a unit time.")%></p>
                                                </div>
                                                             <%}%>
                                        	</div>
                                        <%  } else { %>
                                        <hr />
                                        <div class="form-group">
                                                <label class="control-label col-sm-3" for="resourceTiers"><%=i18n.localize("Resource Level Tiers")%>:
                                                    <a class="help_popup" help_data="resource_policy_help" title="resource_policy_help" data-trigger="hover" data-placement="bottom">
                                                    	<span class="icon fw-stack fw-lg" style="font-size:6px">
                                            				<i class="fw fw-circle fw-stack-2x"></i>
                                            				<i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                                            			</span>
                                                    </a>
                                                    <p id="api_policy_help" class="hide"><%=i18n.localize("Enabling the resource level throttling tier will apply the configured limits per resource")%></p>
                                                </label>

                                            <div id="resource-policy-select" class="controls col-sm-4">
                                                    <script id="resource-policy-ui-template" language="text/x-handlebars-template">
                                                        <a class="select_adv_policy_for_resource btn btn-secondary"><%=i18n.localize("Select Policy per Resource")%></a>
                                                        <div id="resource_policy_modal" class="modal fade">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                                    <h3><%=i18n.localize("Select Policy per Resource")%></h3>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <table class="table">
                                                                            <tr>
                                                                                <td colspan="2"><%=i18n.localize("Resource")%></td>
                                                                                <td><%=i18n.localize("Policy")%></th>
                                                                            </tr>
                                                                            {{#each doc.paths}}
                                                                                {{#each this}}
                                                                                <tr class="resource_container" data-path="">
                                                                                    <td class="resource-method-td resource_expand" data-path="$.paths.['{{ @../key}}'].{{ @key }}">
                                                                                        <span class=" resource-method resource-method-{{ @key }}">{{ @key }}</span>
                                                                                    </td>
                                                                                    <td><a class="resource-path" title="resource_path">{{ @../key}}</a></td>
                                                                                    <td>
                                                                                        <select class="form-control selected input-sm select_resource_policy" data-path="{{ @../key }}" data-method="{{@key}}" data-attr="x-throttling-tier">
                                                                                            {{#each ../../tiers}}
                                                                                                <option value="{{ this.value }}" {{#ifCond this.value '==' ../x-throttling-tier }}selected="selected"{{/ifCond}}>{{ this.text }}</option>
                                                                                            {{/each}}
                                                                                        </select>
                                                                                    </td>
                                                                                </tr>
                                                                                {{/each}}
                                                                            {{/each}}
                                                                        </table>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                    <div id="res" style="color:red;float:left"></div>
                                                                    <a href="#" class="btn btn-primary" data-dismiss="modal" title="<%=i18n.localize("Close")%>" ><%=i18n.localize("Close")%></a>
                                                                    <!-- a href="#" class="btn btn-primary" id="advance_ep_submit" title="<%=i18n.localize("Save")%>" ><%=i18n.localize("Save Changes")%></a -->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </script>
                                                    <a class=" help_popup" help_data="tier_help"></a>
                                                    <p id="tier_help" class="hide"><%=i18n.localize("The tiers selected here determine which tiers are available to a subscriber when subscribing to this API. Each tier indicates the number of requests the subscriber is granted within a unit time.")%></p>
                                                </div>
                                        </div>
                                        <% } %>
                                                      <div class="form-group">
                                                                    <label class="control-label col-sm-3" for="throttle">
                                                                    </label>
                                                                    <div class="col-sm-8">
                                                                          <p class="help-block">
                                        									  <i class="fw fw-info"></i>
                                                                              <%=i18n.localize("Refer ")%>
                                                                              <a target="_blank" href="https://docs.wso2.com/display/AM260/Working+with+Throttling"><%=i18n.localize("documentation")%></a>
                                                                              <%=i18n.localize("for more information about each throttling setting.")%>
                                                                          </p>
                                                                    </div>
                                                                </div>


                                        <!-- End of configuration panel -->


                            </div>
                        </div>
                    </div>
                </div>

        <div class="panel-group accordion add-margin-bottom-2x" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingOne" data-toggle="collapse" data-parent=".accordion" href="#accordion1-collapse1" aria-controls="accordion1-collapse1">
                        <h4 class="panel-title">
                            <div>
                                <% if ( labels != null && labels.length > 0 ) { %>
                                    <div class="heading no-description"><%=i18n.localize("API Gateways / Microgateways")%></div>
                                <%} else {%>
                                    <div class="heading no-description"><%=i18n.localize("API Gateways")%></div>
                                <%}%>
                                <div class="status">
                                    <i class="fw fw-down"></i>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </h4>

                </div>
                <div id="accordion1-collapse1" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                    <div class="panel-body">
                        <b><%=i18n.localize("Gateways")%></b>
                        <table class="table table-striped table-hover display data-table">
                         <thead>
                             <tr>
                                <th width="5%"><div class="environments_checkbox"></div></th>
                                <th width="30%"><div class="environments_data"><%=i18n.localize("Environment Name")%></div></th>
                                <th><div class="environments_data"><%=i18n.localize("Type")%></div></th>
                                <th><div class="environments_data"><%=i18n.localize("Description")%></div></th>
                             </tr>
                         </thead>
                         <tbody>

                         <%
                         var environmentsJson=api.environments;
                         if(environmentsJson=="none"){
                                for(i=0 ;i<environmentsList.length;i++){
                         %>
                            <tr data-type="selectable">
                                <td>
                                    <div class="environments_checkbox">
                                        <label class="checkbox">
                                            <input type="checkbox" value="<%=environmentsList[i].name%>" class="env" name="gateways">
                                            <span class="helper"></span>
                                        </label>
                                    </div>
                                </td>
                                <td><div class="environments_data"><%=environmentsList[i].name%></div></td>
                                <td><div class="environments_data"><%=environmentsList[i].type%></div></td>
                                <td><div class="environments_data"><%=encode.forHtml(environmentsList[i].description)%></div></td>
                            </tr>
                         <%}}
                         else{
                             for(i=0 ;i<environmentsList.length;i++){
                                    if(environmentsJson.split(",").indexOf(environmentsList[i].name)>=0){%>
                                        <tr data-type="selectable">
                                             <td>
                                                <div class="environments_checkbox">
                                                    <label class="checkbox">
                                                        <input type="checkbox" value="<%=environmentsList[i].name%>"
                                                        checked class="env" name="gateways">
                                                        <span class="helper"></span>
                                                    </label>
                                                </div>
                                             </td>
                                             <td><div class="environments_data"><%=environmentsList[i].name%></div></td>
                                             <td><div class="environments_data"><%=environmentsList[i].type%></div></td>
                                             <td><div class="environments_data"><%=encode.forHtml(environmentsList[i].description)%></div></td>
                                        </tr>
                                  <%}else{%>
                                        <tr data-type="selectable">
                                             <td>
                                                <div class="environments_checkbox">
                                                    <label class="checkbox">
                                                        <input type="checkbox" value="<%=environmentsList[i].name%>"
                                                        class="env" name="gateways">
                                                        <span class="helper"></span>
                                                    </label>
                                                </div>
                                             </td>
                                             <td><div class="environments_data"><%=environmentsList[i].name%></div></td>
                                             <td><div class="environments_data"><%=environmentsList[i].type%></div></td>
                                             <td><div class="environments_data"><%=encode.forHtml(environmentsList[i].description)%></div></td>
                                        </tr>

                                   <%}}}%>
                            </tbody>
                       </table>

                        <!-- Microgateways table -->
                        <% if ( labels != null && labels.length > 0 ) { %>
                            <b><%=i18n.localize("Microgateways")%></b>
                                <table class="table table-striped table-hover display data-table">
                                    <thead>
                                        <tr>
                                            <th width="5%"><div class="label_checkbox"></div></th>
                                            <th width="30%"><div class="environments_data"><%=i18n.localize("Label")%></div></th>
                                            <th><div class="environments_data"><%=i18n.localize("Description")%></div></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <%  var currentLabels = "";
                                            for (var i in labels) {
                                                var isLabelAttached = false;
                                                if (attachedLabels != null) {
                                                    var attachedLabelObj = parse(stringify(attachedLabels));
                                                    for (var j=0; j< attachedLabelObj.length; j++){
                                                        if (labels[i].name == attachedLabelObj[j].labelName){
                                                            currentLabels += labels[i].name + ",";
                                                            isLabelAttached = true;
                                                            break;
                                                        }
                                                    }
                                                }%>
                                                <tr data-type="selectable">
                                                    <td>
                                                        <div class="label_checkbox">
                                                        <label class="checkbox">
                                                            <input type="checkbox" value="<%=labels[i].name%>" <% if(isLabelAttached) { %> checked <%}%> name="microgateways" onchange="appendLabels()">
                                                            <span class="helper"></span>
                                                        </label>
                                                        </div>
                                                    </td>
                                                    <td><%=encode.forHtml("" + (labels[i].name))%></td>
                                                    <td><%=encode.forHtml("" + (labels[i].description))%></td>
                                                </tr>
                                            <%}%>
                                    </tbody>
                                </table>
                                <div class="message message-warning" id="mediation-sequence-not-applicable-warning" <% if (attachedLabels != null && hasCustomSequences) { %> style="display:block" <% } else { %> style="display:none" <% } %>>
                                   <h4><i class="icon fw fw-warning"></i>Warning!</h4>
                                   <p><%=i18n.localize("You have selected Microgateways for this API. The mediation policies selected here will not be applied in Microgateway environments.")%></p>
                               </div>
                                <% if (currentLabels.length > 1) {
                                    currentLabels = currentLabels.substring(0, currentLabels.length-1);
                                }%>
                                <input type="hidden" id="gatewayLabels" name="gatewayLabels" value="<%=encode.forHtml("" + currentLabels)%>"/>
                                    <script type="text/javascript">
                                    function appendLabels() {
                                        var selectedLabelSet = '';
                                        var atleastOneLabelChecked = false;
                                        $('input[name="microgateways"]').each(function(){
                                            if(this.checked){
                                                selectedLabelSet = selectedLabelSet + this.value + ',';
                                                atleastOneLabelChecked = true;
                                            }
                                        });
                                        if (selectedLabelSet.endsWith(',')){
                                            selectedLabelSet = selectedLabelSet.slice(0, -1);
                                        }

                                        if (atleastOneLabelChecked && hasCustomSequences) {
                                            $("#mediation-sequence-not-applicable-warning").show();
                                        } else {
                                            $("#mediation-sequence-not-applicable-warning").hide();
                                        }
                                        $("#gatewayLabels").val(selectedLabelSet);
                                    }
                                </script>
                        <%}%><!-- Microgateways table -->

                        <script>
                        $('input').on('change', function() {
                            var values = $('input:checked.env').map(function() {
                                return this.value;
                            }).get();
                        if(values==""){
                        values="none";
                        }
                            $('#environments').val(values.toString());
                        });
                        </script>
                    </div>
                </div>
          </div><!-- Gateway environments -->

          <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingTwo" data-toggle="collapse" data-parent=".accordion" href="#accordion1-collapse2" aria-controls="accordion1-collapse2">
                        <h4 class="panel-title">
                            <div>
                                <div class="heading no-description"><%=i18n.localize("Business Information")%></div>
                                <div class="status">
                                    <i class="fw fw-down"></i>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </h4>

                </div>
                <div id="accordion1-collapse2" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                  <div class="panel-body">
                                <div class="form-group">
                                    <label class="control-label col-sm-3" for="bizOwner"><%=i18n.localize("Business Owner")%>:</label>
                                    <div class="controls col-sm-8">
                                         <input type="text" class=" validInput form-control businessInfo" id="bizOwner" name="bizOwner" value="<%=encode.forHtmlAttribute(api.bizOwner)%>"/>
                                    </div>
                                </div>
                                 <div class="form-group">
                                    <label class="control-label col-sm-3" for="bizOwnerMail"><%=i18n.localize("Business Owner Email")%>:</label>
                                    <div class="controls col-sm-8">
                                         <input type="text" class=" email-validation form-control businessInfo" id="bizOwnerMail" name="bizOwnerMail" value="<%=encode.forHtmlAttribute(api.bizOwnerMail)%>"/>
                                    </div>
                                </div>
                                 <div class="form-group">
                                    <label class="control-label col-sm-3" for="techOwner"><%=i18n.localize("Technical Owner")%>:</label>
                                    <div class="controls col-sm-8">
                                         <input type="text" class=" validInput form-control businessInfo" id="techOwner" name="techOwner" value="<%=encode.forHtmlAttribute(api.techOwner)%>"/>
                                    </div>
                                </div>
                                 <div class="form-group">
                                    <label class="control-label col-sm-3" for="techOwnerMail"><%=i18n.localize("Technical Owner Email")%>:</label>
                                    <div class="controls col-sm-8">
                                         <input type="text" class=" email-validation form-control businessInfo" id="techOwnerMail" name="techOwnerMail" value="<%=encode.forHtmlAttribute(api.techOwnerMail)%>"/>
                                    </div>
                                </div>
                  </div>
                </div>
          </div><!-- Business Information -->
          <!-- Start of Additional Properties -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingThree" data-toggle="collapse" data-parent=".accordion"
                href="#accordion1-collapse3" aria-controls="accordion1-collapse3">
                    <h4 class="panel-title">
                        <div>
                            <div class="heading no-description"><%=i18n.localize("API Properties")%></div>
                            <div class="status">
                                <i class="fw fw-down"></i>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </h4>
                </div>
                <div id="accordion1-collapse3" class="panel-collapse collapse" role="tabpanel"
                aria-labelledby="headingThree">
                  <div class="panel-body">
                        <!-- UI components related with adding additional properties -->
                        <% if( api != null) { %>
                                <input hidden id = "api_properties" value="<%= encode.forHtml(api.additionalProperties)%>"
                                    name="additionalProperties" />
                        <% } else { %>
                                <input hidden id = "api_properties" value="null" name="additionalProperties"/>
                        <% } %>
                        <div id = "additionalProperties"></div>
                  </div>
                </div>
            </div>
           </div>   <!-- End of Additional Properties -->


        <div class="panel-group accordion">
            <div class="panel panel-default">
                 <%if(!isWSAPI){%>
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <div>
                            <div class="heading no-description"><%=i18n.localize("Resources")%></div>
                        </div>
                        <div class="clearfix"></div>
                    </h4>
                </div>
                    <%}%>
                <div class="panel-collapse">
                    <div class="panel-body">
                         <%if(!isWSAPI){%>
                    <!-- Resources Information -->
                        <div id="api_designer">
                            <div id ="apidoc_details"></div>
                            <div id="scopes_view"></div>
                            <div id ="resource_details"></div>
                        </div>
                        <!-- Resources Information -->
                             <%}%>
                        <hr/>
                            <input type="hidden" id="environments" name="environments" value='<%=environmentsJson%>'/>
                            <input type="hidden" name="name" value="<%= encode.forHtml(api.name) %>" />
                            <input type="hidden" name="version" value="<%= encode.forHtml(api.version) %>" />
                            <input type="hidden" name="provider" value="<%= encode.forHtml(api.provider) %>" />
                            <input type="hidden" name="action" value="manage" />
                            <input type="hidden" id="swagger" name="swagger" value="" />
                            <div class="form-actions" style="display:none" id="saveMessage">
                                <div class="btn loadingButton"><%=i18n.localize("Saving API. Please wait..")%></div>
                            </div>
                            <div class="form-actions" id="saveButtons">

                                <button class="btn btn-secondary has-spinner" id="save_api"><%=i18n.localize("Save")%></button>
                                <% if(outputs.isPermitted) {
                                   var status=outputs.lcStatus;
                                   var wfStatus = "";
                                   if(outputs.wfStatus != null && outputs.wfStatus.status != null){
                                     wfStatus = outputs.wfStatus.status;               
                                   }
                                %>
                                     <% if(status=="BLOCKED" || status=="DEPRECATED" || status=="RETIRED" || wfStatus=="CREATED"){ %>
                                     <a class="btn btn-primary" id="publish_api_disabled" disabled title="<%=i18n.localize("Save & Publish")%>"><%=i18n.localize("Save & Publish")%></a>
                                     <%} else{%>
                                     <a class="btn btn-primary has-spinner" id="publish_api" title="<%=i18n.localize("Save & Publish")%>"><%=i18n.localize("Save & Publish")%></a>
                                     <%}%>
                                <%}%>

                                <input type="reset" class="btn btn-secondary" value="<%=i18n.localize("Cancel")%>" onclick="javascript:window.location.href='./'" />
                                <label id="gateway_error" class="bg-warning hide" style="display: block;padding:
                                10px; border-radius: 5px;margin-top:10px;"><%=i18n
                                .localize("Some of the gateway environments are not selected.")%></label>
                            </div>
                    </div>
                </div>
            </div>
        </div>

    </form>
</div>

        <div id="publish-success" class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fw fw-cancel"></i></button>
                <h3><%=i18n.localize("Congratulations... What&#39;s Next?")%></h3>
              </div>
              <div class="modal-body">
                <p>
                    <%=i18n.localize("You have successfully published your API")%>: <strong><%=api.name%>-<%=api.version%></strong>
                </p>
              </div>
              <div class="modal-footer successMsgFooter">
                <div class="pull-right">
                <button id="editAPI-btn" class="btn btn-secondary" data-dismiss="modal" aria-hidden="true" title="<%=i18n.localize("Keep Editing API")%>"><%=i18n.localize("Keep Editing API")%></button>
                <a href='javascript:void(0)' id="goToStore-btn" class="btn btn-secondary" title="<%=i18n.localize("Go to API Store")%>"><%=i18n.localize("Go to API Store")%></a>
                <a href="<%= jagg.url("/info?"+ apiUrlId ) %>" class="btn btn-primary" title="<%=i18n.localize("Go to Overview")%>"><%=i18n.localize("Go to Overview")%></a>
                </div>
              </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->



        <div id="waiting-approval" class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fw fw-cancel"></i></button>
                <h3><%=i18n.localize("approval waiting topic")%></h3>
              </div>
              <div class="modal-body">
                <p>
                    <%=i18n.localize("approval waiting message")%>
                </p>
              </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->



    </div>

                        </div>
                    </div>
                </div>
            </div>


    </div>
    </div>
</div>

<script id="designer-apidoc-template" type="text/x-handlebars-template">
</script>

<!-- Script to add additional properties -->
<script id="properties-add-template" type="text/x-handlebars-template">
    <div class="form-group">
        <label class="col-sm-3 control-label col-md-3 col-xs-3"><%=i18n.localize("Additional Properties")%>:</label>
           <div class="col-sm-3 col-md-3 col-xs-3">
               <div class="row">
                    <div class="col-sm-10 col-md-10 col-xs-10" >
                        <input id="property_key" type="text" placeholder="property name" class="form-control"/>
                        <label id="property_key_error" class="error hidden" ></label>
                    </div>
                    <div class="col-sm-1 col-md-1 col-xs-1" style="padding-left: 0; padding-top: 5px">
                        <a id="property_key_help" class="help_popup input-group-btn" help_data="property_key_help_data"
                            data-trigger="hover" data-placement="bottom">
                            <span class="icon fw-stack fw-lg" style="font-size:6px">
                                <i class="fw fw-circle fw-stack-2x"></i>
                                <i class="fw fw-question fw-stack-1x fw-inverse" style="font-size:8px"></i>
                            </span>
                        </a>
                        <p id="property_key_help_data" class="hide"><%=i18n.localize("Property name should match following criteria.<br/>1. Property name should not contain space in it. 2.Property name should not contain any of the reserved keywords.<br/> <strong>Reserved Keywords </strong> : [name, description, provider, version, context, doc,tags, lcstate, status, subcontext]")%></p>
                 </div>
                </div>
           </div>
        <div class="col-sm-4 col-md-4 col-xs-4">
            <input id="property_value" type="text" placeholder="property value" class="form-control"/>
             <label id="property_value_error" class="error hidden"></label>
        </div>
        <div class="col-sm-2 col-md-2 col-xs-2">
            <a class="btn" id="property_add">
                <span class="icon fw-stack" style="font-size:10px">
                    <i class="fw fw-add fw-stack-1x"></i>
                    <i class="fw fw-circle-outline fw-stack-2x"></i>
                </span>
            </a>
        </div>
    </div>

    <div class="col-sm-6 col-lg-offset-3 col-md-6 col-xs-6">
        {{#if properties}}
            <table class="table table-striped table-responsive">
                <thead>
                    <tr>
                        <td><strong><%=i18n.localize("Property Name")%></strong></td>
                        <td><strong><%=i18n.localize("Property Value")%></strong></td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    {{#each properties}}
                    <tr>
                        <td style="word-wrap: break-word;min-width: 100px;max-width: 160px;white-space:normal;
                        ">{{@key}}</td>
                        <td style="word-wrap: break-word;min-width: 100px;max-width: 300px;white-space:normal;
                        ">{{this}}</td>
                        <td align="right">
                            <a class="delete-properties" data-key="{{@key}}" data-value="{{this}}">
                                <span class="fw-stack" style="font-size:10px">
                                    <i class="fw fw-delete fw-stack-1x"></i>
                                    <i class="fw fw-circle-outline fw-stack-2x"></i>
                                </span>
                            </a>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        {{/if}}
    </div>
</script>
<!-- End of script for properties addition-->


<script id="designer-resource-template" type="text/x-handlebars-template">
<div class="resource_body_padding">
    <h5><%=i18n.localize("Description")%> :</h5>
    <a class="notes" data-path="{{resource_path}}" data-attr="description" title="<%=i18n.localize("Description")%>">{{ description }}</a><br />
    <h5><%=i18n.localize("Response Content Type")%> : <a href="#" data-path="{{resource_path}}" data-attr="content_type" class="content_type" data-type="typeahead" data-pk="1" data-title="<%=i18n.localize("Response Content Type")%>" title="<%=i18n.localize("Response Content Type")%>">{{ content_type }}</a></h5>
    <h5><%=i18n.localize("Parameters")%> :</h5>
    {{#if parameters}}
    <table class="table table-condensed table-hover table-bordered">
        <tr>
        <th width="200px"><%=i18n.localize("Parameter Name")%></th>
        <th>Description</th>
        <th width="100px"><%=i18n.localize("Parameter Type")%></th>
        <th width="100px"><%=i18n.localize("Data Type")%></th>
        <th width="100px"><%=i18n.localize("Required")%></th>
        </tr>
    {{#each parameters}}
        <tr>
        <td>{{ name }}</td>
        <td>{{ description }}</td>
        <td>{{ in }}</td>
        <td>{{ type }}</td>
        <td>{{toString required }}</td>
        </tr>
    {{/each}}
    {{/if}}
    </table>
</div>
</script>

<script id="designer-sequence-template" type="text/x-handlebars-template">
<div class="resource_body_padding">
    <h5><%=i18n.localize("Description")%> :</h5>
    <a class="notes" data-path="{{resource_path}}" data-attr="description" title="<%=i18n.localize("Description")%>">{{ description }}</a><br />
    <h5><%=i18n.localize("Response Content Type")%> : <a href="#" data-path="{{resource_path}}" data-attr="content_type" class="content_type" data-type="typeahead" data-pk="1" data-title="<%=i18n.localize("Response Content Type")%>" title="<%=i18n.localize("Response Content Type")%>">{{ content_type }}</a></h5>
    <h5><%=i18n.localize("Parameters")%> :</h5>
    {{#if parameters}}
    <table class="table table-condensed table-hover table-bordered">
        <tr>
        <th width="200px"><%=i18n.localize("Parameter Name")%></th>
        <th>Description</th>
        <th width="100px"><%=i18n.localize("Parameter Type")%></th>
        <th width="100px"><%=i18n.localize("Data Type")%></th>
        <th width="100px"><%=i18n.localize("Required")%></th>
        </tr>
    {{#each parameters}}
        <tr>
        <td>{{ name }}</td>
        <td>{{ description }}</td>
        <td>{{ in }}</td>
        <td>{{ type }}</td>
        <td>{{toString required }}</td>
        </tr>
    {{/each}}
    {{/if}}
    </table>
</div>
</script>

<script id="designer-resources-template" type="text/x-handlebars-template">
<br />
<table style="width:100%">
{{#each doc.paths}}
    {{# each this}}
        <tr class="resource_container" data-path="$.paths.['{{ path }}'].{{@key}}">
            <td class="resource-method-td resource_expand" data-path="$.paths.['{{ path }}'].{{ @key }}">
                <span class=" resource-method resource-method-{{ @key }}">{{ @key }}</span>
            </td>
            <td class="resource_expand"><a class="resource-path" title="resource_path">{{ path }}</a></td>
            <td><span class="operation-summary change_summary" data-path="$.paths.['{{ path }}'].{{@key}}" data-attr="summary" >{{ summary }}</span></td>
            <td><a class="operation-summary auth_type_select"  data-type="select" data-path="$.paths.['{{ path }}'].{{@key}}" data-attr="x-auth-type" data-value="{{ x-auth-type }}" title="x-auth-type"></a></td>
            <td><a class='operation-summary throttling_select'  data-type="select" data-path="$.paths.['{{ path }}'].{{@key}}" data-attr="x-throttling-tier" title="x-throttling-tier">{{ x-throttling-tier }}</a></td>
            <td><a class="operation-summary scope_select"  data-type="select" data-path="$.paths.['{{ path }}'].{{@key}}" data-attr="x-scope" title="x-scope">{{ x-scope }}</a></td>        </tr>
        <tr><td colspan="6" class="resource_body " data-path="$.paths.['{{ path }}'].{{@key}}"></td></tr>
    {{/each}}
{{/each}}
</table>
</script>

<script id="scopes-template" type="text/x-handlebars-template">
    <div class="scope_container">
        <div class="form-group">
            <label class="control-label col-sm-3" for="scopes"><%=i18n.localize("Scopes")%>:</label>
            <div class="controls col-sm-9">
                {{#if api_doc.x-wso2-security.apim.x-wso2-scopes }}
                 <ul class="scopes-list">
                     {{#each api_doc.x-wso2-security.apim.x-wso2-scopes }}
                     <li>
                         <div>
                         <a data-index='{{ @index }}' class='delete_scope pull-right' title="<%=i18n.localize("Remove Scope")%>">
                            <span class="fw-stack" style="font-size:10px">
                                <i class="fw fw-delete fw-stack-1x"></i>
                                 <i class="fw fw-circle-outline fw-stack-2x"></i>
                            </span>
                         </a>
                         <span><strong>{{ key }}</strong></span>
                         {{#if name }}
                            <span class="text-muted">: {{ name }}</span>
                         {{/if}}
                         </div>
                         <span>Roles</span> : {{ roles }}
                         <p class="text-muted">{{ description }}</p>
                     </li>
                     {{/each}}
                 </ul>
                {{/if}}
                <button id="define_scopes" class="pointer btn btn-secondary" title="define_scopes" type="button">
                    <span class="icon fw-stack" style="font-size:10px;">
                        <i class="fw fw-add fw-stack-1x"></i>
                        <i class="fw fw-circle-outline fw-stack-2x"></i>
                    </span>
                    <%=i18n.localize("Add Scopes")%>
                </button>
            </div>
        </div>
    </div>
</script>

<script>
    var setIntervalId;
    function runSuccessMessageHint() {
        setIntervalId = setInterval(function() {
            runEnjoyHintScriptOnApiPublish()
        }, 1000);
    }

    function runEnjoyHintScriptOnApiPublish() {
        if (isEnjoyHintEnabled()) {
            runEnjoyHintScript(enjoyhint_instance_onMessage, item_manage_success_message_script_data);
            stopSuccessMessageHint();
        }
    }

    function stopSuccessMessageHint() {
        clearInterval(setIntervalId);
    }


   

    var enjoyhint_instance_item_manage = null;
    var enjoyhint_instance_onMessage = null;

    $(document).ready(function(){
        $.ajaxSetup({
            contentType: "application/x-www-form-urlencoded; charset=utf-8"
        });

        $.get( "<%= jagg.url("/site/blocks/item-design/ajax/add.jag?" + apiUrlId ) %>&action=swagger" , function( data ) {
            var data = jQuery.parseJSON(data);
            var designer = APIDesigner();
            designer.load_api_document(data);
            designer.set_default_management_values();
            designer.render_resources();
            $("#swaggerUpload").modal('hide');
            showHideResourceLevelTierSelection();
        });

        var publish_api = function(e){
            $.ajax({
                type: "POST",
                url: "<%= jagg.url("/site/blocks/life-cycles/ajax/life-cycles.jag") %>",
		        async : false,
                data: {
                    action :"updateStatus",
                    name:"<%=api.name%>",
                    version:"<%=api.version%>",
                    provider: "<%=api.provider%>",
                    status: "Publish",
                    publishToGateway:true,
                    requireResubscription:true
                },
                success: function(responseText){
                    $("body").unbind('api_saved');
                    if (!responseText.error) {
                        var jsonObj = JSON.stringify(responseText);                        
                        var jsonPayload = responseText.status.workflowResponse.jsonPayload;
                        if (responseText.status.stateChangeStatus == 'REJECTED') {
                                showWorkflowRejectedMessage();
                        } else if (responseText.status.stateChangeStatus == 'CREATED') {
                                showWorkflowSubmittedMessage();
                        } else if (jsonPayload != null && jsonPayload != "") {
                            var apiInfo = {};
                                apiInfo.provider = "<%=api.provider%>";
                                apiInfo.name = "<%=api.name%>";
                                apiInfo.version = "<%=api.version%>";
                                handleWorkflowRedirection(jsonPayload, apiInfo);

                        } else {
                            $('#publish-success').modal({
                                backdrop: 'static',
                                keyboard: false
                            });
                            $('#publish-success').modal('show');
                            runSuccessMessageHint();
                            $('#goToStore-btn').click(function(){
                                window.open('<%=storeUrl%>/apis/info?name=<%=api.name%>&version=<%=api.version%>&provider=<%=api.provider%>&tenant=<%=tenantDomain%>', '_blank');
                                location.href = '<%= jagg.url("/info?"+ apiUrlId ) %>';
                            });
                        }
                    } else {
                         if (responseText.message == "timeout") {
                             if (ssoEnabled) {
                                 var currentLoc = window.location.pathname;
                                 var queryString=encodeURIComponent(window.location.search);
                                 if (currentLoc.indexOf(".jag") >= 0) {
                                     location.href = "login.jag?requestedPage=" + currentLoc + queryString;
                                 } else {
                                     location.href = 'site/pages/login.jag?requestedPage=' + currentLoc + queryString;
                                 }
                             } else {
                                 jagg.showLogin();
                             }
                         } else {
                              var message=responseText.message;
                                   if(message.split("||")[1]=="warning"){
                                     var environmentsFailed=JSON.parse(message.split("||")[0]);
                                     var failedToPublishEnvironments=environmentsFailed.PUBLISHED;
                                     var failedToUnpublishedEnvironments=environmentsFailed.UNPUBLISHED;
                                     var divPublish="",divUnpublished="";
                                     for(i= 0; i< failedToPublishEnvironments.split(",").length;i++){
                                        var splitPublished = (failedToPublishEnvironments.split(",")[i]).split(":");
                                        divPublish+=splitPublished[0]+"<br>"+splitPublished[1]+"<br>";
                                         }
                                     for(i= 0; i< failedToUnpublishedEnvironments.split(",").length;i++){
                                        var splitUnPublished = (failedToUnpublishedEnvironments.split(",")[i]).split(":");

                                        divUnpublished+=splitUnPublished[0]+"<br>"+splitUnPublished[1]+"<br>";
                                         }
                                       $( "#modal-published-content" ).empty();
                                       $( "#modal-unpublished-content" ).empty();
                                       $( "#modal-published-content" ).append(divPublish);
                                       $( "#modal-unpublished-content" ).append(divUnpublished);
                                       if(failedToPublishEnvironments==""){
                                       $("#modal-published-header").hide();
                                       $("#modal-published-content").hide();
                                        }
                                       if(failedToUnpublishedEnvironments==""){
                                            $("#modal-unpublished-header").hide();
                                            $("#modal-unpublished-content").hide();
                                          }
                                         $("#retryType").val("manage");
                                         $("#environmentsRetry-modal").modal('show');
                                   }
                                   else{
                                   jagg.message({content:responseText.message,type:"error"});
                                       }
                         }
                     }
                },
                dataType: "json"
            });
        };

        $("#scope_form").validate();

        var v = $("#manage_form").validate({
            submitHandler: function(form) {
            var tiersValidated = validate_tiers();
            var subscriptionValidated = validateSubscription();
            if(!tiersValidated || !subscriptionValidated){
                return false;
            }
            if(!validate_Transports()){
                return false;
            }
            var designer = APIDesigner();
            $('#swagger').val(JSON.stringify(designer.api_doc));
            $('#'+thisID).buttonLoader('start');
            $(form).ajaxSubmit({
                success:function(responseText, statusText, xhr, $form) {
                    $('#'+thisID).buttonLoader('stop');
                    if (!responseText.error) {
                        $( "body" ).trigger( "api_saved" );
                    } else {
                         if (responseText.message == "timeout") {
                             if (ssoEnabled) {
                                 var currentLoc = window.location.pathname;
                                 var queryString=encodeURIComponent(window.location.search);
                                 if (currentLoc.indexOf(".jag") >= 0) {
                                     location.href = "login.jag?requestedPage=" + currentLoc + queryString;
                                 } else {
                                     location.href = 'site/pages/login.jag?requestedPage=' + currentLoc + queryString;
                                 }
                             } else {
                                 jagg.showLogin();
                             }
                         } else {
                         var message=responseText.message;
                         if(message.split("||")[1]=="warning"){
                          var environmentsFailed=JSON.parse(message.split("||")[0]);
                          var failedToPublishEnvironments=environmentsFailed.PUBLISHED;
                           var failedToUnpublishedEnvironments=environmentsFailed.UNPUBLISHED;
                           var divPublish="",divUnpublished="";
                                       for(i= 0; i< failedToPublishEnvironments.split(",").length;i++){
                                      divPublish+=failedToPublishEnvironments.split(",")[i]+"<br>";
                                     }
                                   for(i= 0; i< failedToUnpublishedEnvironments.split(",").length;i++){
                                   divUnpublished+=failedToUnpublishedEnvironments.split(",")[i]+"<br>";
                                  }
                                  $( "#modal-published-content" ).empty();
                                 $( "#modal-unpublished-content" ).empty();
                            $( "#modal-published-content" ).append(divPublish);
                           $( "#modal-unpublished-content" ).append(divUnpublished);
                             if(failedToPublishEnvironments==""){
                                            $("#modal-published-header").hide();
                                            $("#modal-published-content").hide();
                                            }
                                                 if(failedToUnpublishedEnvironments==""){
                                                                    $("#modal-unpublished-header").hide();
                                                                    $("#modal-unpublished-content").hide();
                                                                    }
                                $("#retryType").val("lifeCycle");
                                $("#environmentsRetry-modal").modal('show');
                         }
                         else{
                        jagg.message({content:responseText.message,type:"error"});
                         }
                                                  }
                    }
                },
                error: function(){
                    $('#'+thisID).buttonLoader('stop');
                    jagg.message({content:"<%=i18n.localize("Error occurred while updating the API")%>",type:"error"});
                },
                dataType: 'json'
            });
            }
        });

        var submitForm = function(){$("body").on("api_saved", publish_api);
            $('#messageModal').modal('hide');
                if(!$("#backend_tps_specify").is(":checked")) {
                // Setting text field values to null if check box is not selected.
                    $('#productionTps').val(null);
                    $('#sandboxTps').val(null);
            }
            $("#manage_form").submit();
            };

        var thisID='';
        $('#publish_api').on("click",function(e){
            thisID = $(this).attr('id');
            var isChecked = false;
            $("input[name='gateways']:checked").each(function() {
                isChecked = true;
            });
            if(!isChecked){
                $("#messageModal div.modal-footer").html("");
                jagg.message({content:"<%=i18n.localize('Gateways Unchecked')%>", type:"confirm",anotherDialog:true, okCallback:submitForm});
            } else{
                submitForm();
            }
        });

        $('#save_api').click(function(e){
            if(!$("#backend_tps_specify").is(":checked")) {
                // Setting text field values to null if check box is not selected.
                $('#productionTps').val(null);
                $('#sandboxTps').val(null);
            }
            thisID=$(this).attr('id');
            $('#apiSaved').show();
            setTimeout("hideMsg()", 3000);
        });


        $('#responseCache').change(function(){
            var cache = $('#responseCache').find(":selected").val();
            if(cache == "enabled"){
                $('#cacheTimeout').show();
            }
            else{
                $('#cacheTimeout').hide();
            }
        });
        if (isEnjoyHintEnabled()) {
            runEnjoyHintScript(enjoyhint_instance_item_manage, item_manage_script_data);
        }
    });

    var hideMsg=function () {
        $('#apiSaved').hide("slow");
    }
</script>


<div  id="define_scope_modal" class="modal fade">
    <div class="modal-dialog">
    <div class="modal-content">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3><%=i18n.localize("Define Scope")%></h3>
    </div>
    <div class="modal-body">
    <form id="scope_form" class="form-horizontal">
        <div class="form-group">
            <label class="control-label col-sm-3" for="scopeKey"><%=i18n.localize("Scope Key")%><span class="requiredAstrix">*</span></label>
            <div class="col-sm-4">
            <input type="text" id="scopeKey" name="scopeKey" class="form-control required characterValidation" placeholder="<%=i18n.localize("Eg: api_name_read")%>">
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-3" for="scopeName"><%=i18n.localize("Scope Name")%><span class="requiredAstrix">*</span></label>
            <div class="col-sm-4">
            <input type="text" id="scopeName" name="scopeName"  class="form-control required characterValidationExceptSpace" placeholder="<%=i18n.localize("Eg: Read My Data")%>">
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-3" for="scopeRoles"><%=i18n.localize("Roles")%></label>
            <div class="col-sm-4">
            <input type="text" id="scopeRoles" class="form-control" placeholder="<%=i18n.localize("E.g.: role1,role2,role3")%>" data-role="tagsinput" />
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-3" for="inputEmail"><%=i18n.localize("Description")%></label>
            <div class="col-sm-4">
            <textarea id="scopeDescription" class="form-control" placeholder="<%=i18n.localize("Eg: This scope will group all the administration APIs")%>"></textarea>
            </div>
        </div>
    </form>
    </div>
    <div class="modal-footer">
    <div id="res" class="hide" style="color:red;float:left"></div>
    <a class="btn btn-primary" id="scope_submit" title="<%=i18n.localize("Add Scopes")%>">Add Scope</a>
    <a class="btn btn-secondary" data-dismiss="modal" title="<%=i18n.localize("Close")%>">Close</a>
    </div>
    </div>
    </div>
</div>

<div  id="environmentsRetry-modal" class="modal fade">

    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3><%=i18n.localize("Gateway Failures")%></h3>
        </div>
        <div class="modal-body">
            <div id="modal-published-header">
            <%=i18n.localize("Failed to Publish Environments")%>
            </div>
            <div id="modal-published-content">
            </div>
            <div id="modal-unpublished-header">
                <%=i18n.localize("Failed to UnPublish Environments")%>
            </div>
            <div id="modal-unpublished-content">
            </div>
            <input type="hidden" id="retryType"/>
        </div>
        <div class="modal-footer">
            <div id="res" class="hide" style="color:red;float:left"></div>
            <a class="btn btn-primary" id="retry" onClick="doGatewayAction()" title="ok">OK</a>
           <script type="text/javascript">
            function doGatewayAction() {
                var type=$("#retryType").val();
                if(type=="manage"){
                   $("#environmentsRetry-modal").modal('hide');
                   $( "body" ).trigger( "api_saved" );
                   location.href = "<%= jagg.url("/info?"+ apiUrlId ) %>";
                }else{
                   location.href = "<%= jagg.url("/info?"+ apiUrlId ) %>";
                }
            }
            </script>
        </div>
      </div>
    </div>
</div>
       <script type="text/javascript">
        jQuery.validator.addMethod("characterValidation", function(value, element) {
            // not allow any special charaters
            return this.optional( element ) || /^[^`~!@#$%^&*()|+\=?;:'",.<>\{\}\[\]\\\/\s\t\n]*$/.test( value );
        }, '<%=i18n.localize("Field contains special characters")%>');

        //character validation excluding space
        jQuery.validator.addMethod("characterValidationExceptSpace", function(value, element) {
            // not allow any special charaters
            return this.optional( element ) || /^[^`~!@#$%^&*()|+\-=?;:'",.<>\{\}\[\]\\\/\t\n]*$/.test( value );
        }, '<%=i18n.localize("Field contains special characters")%>');
       </script>

<% }); %>
